#!/bin/bash

#Fail this script should any operation fail
set -e
set -o pipefail

# Utility functions
##########

function enforce_root {
    if [ "$(whoami)" != "root" ];
    then
        echo "Please re-run this script as root (eg: 'sudo bash <script>').";
        echo "#####"
        exit;
    fi
}

# Checks, user input, and input validation
##########

enforce_root;

echo "This script will install commonly used tools."
echo "#####"

# The config script
##########

echo "Installing apt packages."
echo "#####"
# Install LTS nodejs 4.x, automatically calls apt-get update
curl -sL https://deb.nodesource.com/setup_4.x | bash -
apt-get -y install nodejs
# Common dev tools
apt-get -y install grep sed gnupg curl nano vim git clang g++ postgresql screen

echo "Installing RVM, Ruby, and Bundler."
echo "#####"
# Install RVM, ruby, and rubygems (as a part of the ruby install)
gpg --keyserver hkp://keys.gnupg.net --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3
\curl -sSL https://get.rvm.io | bash -s stable --ruby
# Other GitHub pages dependencies
source /usr/local/rvm/scripts/rvm
gem install bundler

echo "Making a projects directory."
echo "#####"
su - $SUDO_USER -c "mkdir -p ~/projects"

echo "Adding convenience shortcuts."
echo "#####"
if ! grep -q "alias proj" ~/.bashrc;
then
    echo "# Added by ubuntu-tools script" >> ~/.bashrc
    echo "alias proj=\"cd ~/projects/\"" >> ~/.bashrc
fi
if ! grep -q "alias serv" ~/.bashrc;
then
    echo "# Added by ubuntu-tools script" >> ~/.bashrc
    echo "alias serv=\"python -m SimpleHTTPServer 4000\"" >> ~/.bashrc
fi

echo "Done!"
echo "To use RVM, run 'source /usr/local/rvm/scripts/rvm'."
echo "To use the newly added shortcuts, run 'source ~/.bashrc'"
echo "#####"
